



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Build a fully functional NAS with an Ubuntu box and this playbook">
      
      
        <link rel="canonical" href="https://davestephens.uk/ansible-nas/zfs/zfs_overview/">
      
      
        <meta name="author" content="David Stephens">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>ZFS Overview - Ansible-NAS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="manifest" href="../../manifest.webmanifest">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#zfs-overview" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://davestephens.uk/ansible-nas" title="Ansible-NAS" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Ansible-NAS
            </span>
            <span class="md-header-nav__topic">
              
                ZFS Overview
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/davestephens/ansible-nas/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    davestephens/ansible-nas
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://davestephens.uk/ansible-nas" title="Ansible-NAS" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Ansible-NAS
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/davestephens/ansible-nas/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    davestephens/ansible-nas
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../hardware/" title="Hardware" class="md-nav__link">
      Hardware
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../post_installation/" title="Post installation" class="md-nav__link">
      Post installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../support/" title="Support" class="md-nav__link">
      Support
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../testing/" title="Testing" class="md-nav__link">
      Testing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../upgrading/" title="Upgrading Ansible-NAS" class="md-nav__link">
      Upgrading Ansible-NAS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Applications
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Applications
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/airsonic/" title="Airsonic" class="md-nav__link">
      Airsonic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/bazarr/" title="Bazarr subtitle downloader" class="md-nav__link">
      Bazarr subtitle downloader
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/bitwarden/" title="Bitwarden(_rs) Password Management" class="md-nav__link">
      Bitwarden(_rs) Password Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/calibre/" title="Calibre(-web) eBook Library" class="md-nav__link">
      Calibre(-web) eBook Library
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/cloudcmd/" title="Cloud Commander file manager" class="md-nav__link">
      Cloud Commander file manager
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/cloudflare_ddns/" title="Cloudflare Dynamic DNS Updater" class="md-nav__link">
      Cloudflare Dynamic DNS Updater
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/emby/" title="Emby" class="md-nav__link">
      Emby
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/firefly/" title="Firefly III" class="md-nav__link">
      Firefly III
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/get_iplayer/" title="get_iplayer" class="md-nav__link">
      get_iplayer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/guacamole/" title="Guacamole" class="md-nav__link">
      Guacamole
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/homeassistant/" title="Home Assistant" class="md-nav__link">
      Home Assistant
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/homebridge/" title="Homebridge" class="md-nav__link">
      Homebridge
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/jackett/" title="Jackett" class="md-nav__link">
      Jackett
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/jellyfin/" title="Jellyfin" class="md-nav__link">
      Jellyfin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/joomla/" title="Joomla CMS" class="md-nav__link">
      Joomla CMS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/lidarr/" title="Lidarr music collection manager" class="md-nav__link">
      Lidarr music collection manager
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/minidlna/" title="MiniDLNA" class="md-nav__link">
      MiniDLNA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/miniflux/" title="Miniflux" class="md-nav__link">
      Miniflux
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/mosquitto/" title="Mosquitto" class="md-nav__link">
      Mosquitto
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/mymediaforalexa/" title="My Media for Alexa" class="md-nav__link">
      My Media for Alexa
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/nextcloud/" title="Nextcloud" class="md-nav__link">
      Nextcloud
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/nzbget/" title="NZBget" class="md-nav__link">
      NZBget
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/ombi/" title="Ombi" class="md-nav__link">
      Ombi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/openhab/" title="openHAB" class="md-nav__link">
      openHAB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/pyload/" title="pyLoad" class="md-nav__link">
      pyLoad
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/radarr/" title="Sonarr & Radarr" class="md-nav__link">
      Sonarr & Radarr
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/serposcope/" title="Serposcope" class="md-nav__link">
      Serposcope
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/sonarr/" title="Sonarr & Radarr" class="md-nav__link">
      Sonarr & Radarr
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/thelounge/" title="The Lounge" class="md-nav__link">
      The Lounge
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/timemachine/" title="Time Machine" class="md-nav__link">
      Time Machine
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/traefik/" title="Traefik" class="md-nav__link">
      Traefik
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/transmission/" title="Transmission" class="md-nav__link">
      Transmission
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/ubooquity/" title="Ubooquity Comic and Book Server" class="md-nav__link">
      Ubooquity Comic and Book Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/virtual_desktop/" title="Virtual Desktop" class="md-nav__link">
      Virtual Desktop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/wallabag/" title="Wallabag" class="md-nav__link">
      Wallabag
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/watchtower/" title="Watchtower" class="md-nav__link">
      Watchtower
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Configuration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Configuration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/application_ports/" title="Application Ports" class="md-nav__link">
      Application Ports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/custom_applications/" title="Custom Applications" class="md-nav__link">
      Custom Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/external_access/" title="External Access" class="md-nav__link">
      External Access
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/nfs_exports/" title="NFS Exports" class="md-nav__link">
      NFS Exports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/samba_shares/" title="Samba Shares" class="md-nav__link">
      Samba Shares
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11" checked>
    
    <label class="md-nav__link" for="nav-11">
      Zfs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Zfs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../zfs_configuration/" title="ZFS Configuration" class="md-nav__link">
      ZFS Configuration
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        ZFS Overview
      </label>
    
    <a href="./" title="ZFS Overview" class="md-nav__link md-nav__link--active">
      ZFS Overview
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-zfs-and-why-would-i-want-it" class="md-nav__link">
    What is ZFS and why would I want it?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#an-overview-and-some-actual-commands" class="md-nav__link">
    An overview and some actual commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#known-issues" class="md-nav__link">
    Known issues
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#myths-and-misunderstandings" class="md-nav__link">
    Myths and misunderstandings
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-zfs-does-not-need-at-least-8-gb-of-ram" class="md-nav__link">
    No, ZFS does not need at least 8 GB of RAM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-ecc-ram-is-not-required-for-zfs" class="md-nav__link">
    No, ECC RAM is not required for ZFS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-the-slog-is-not-really-a-write-cache" class="md-nav__link">
    No, the SLOG is not really a write cache
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-reading-and-viewing" class="md-nav__link">
    Further reading and viewing
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-zfs-and-why-would-i-want-it" class="md-nav__link">
    What is ZFS and why would I want it?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#an-overview-and-some-actual-commands" class="md-nav__link">
    An overview and some actual commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#known-issues" class="md-nav__link">
    Known issues
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#myths-and-misunderstandings" class="md-nav__link">
    Myths and misunderstandings
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-zfs-does-not-need-at-least-8-gb-of-ram" class="md-nav__link">
    No, ZFS does not need at least 8 GB of RAM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-ecc-ram-is-not-required-for-zfs" class="md-nav__link">
    No, ECC RAM is not required for ZFS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-the-slog-is-not-really-a-write-cache" class="md-nav__link">
    No, the SLOG is not really a write cache
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-reading-and-viewing" class="md-nav__link">
    Further reading and viewing
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/davestephens/ansible-nas/edit/master/docs/zfs/zfs_overview.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="zfs-overview">ZFS Overview</h1>
<p>This is a general overview of the ZFS file system for people who are new to it.
If you have some experience and are actually looking for specific information
about how to configure ZFS for Ansible-NAS, check out the <a href="../zfs_configuration/">ZFS example
configuration</a>.  </p>
<h2 id="what-is-zfs-and-why-would-i-want-it">What is ZFS and why would I want it?</h2>
<p><a href="https://en.wikipedia.org/wiki/ZFS">ZFS</a> is an advanced filesystem and volume
manager originally created by Sun Microsystems starting in 2001. First released
in 2005 for OpenSolaris, Oracle later bought Sun and switched to developing ZFS
as closed source software. An open source fork took the name
<a href="http://www.open-zfs.org/wiki/Main_Page">OpenZFS</a>, but is still called "ZFS" for
short. It runs on Linux, FreeBSD, illumos and other platforms.</p>
<p>ZFS aims to be the <a href="https://blogs.oracle.com/bonwick/zfs:-the-last-word-in-filesystems">"last word in
filesystems"</a>,
a technology so future-proof that Michael W. Lucas and Allan Jude famously
stated that the <em>Enterprise's</em> computer on <em>Star Trek</em> probably runs it. The
design was based on <a href="https://www.youtube.com/watch?v=MsY-BafQgj4">four
principles</a>:</p>
<ol>
<li>
<p>"Pooled" storage to eliminate the notion of volumes. You can add more storage
   the same way you just add a RAM stick to memory.</p>
</li>
<li>
<p>Make sure data is always consistent on the disks. There is no <code>fsck</code> command
   for ZFS and none is needed.</p>
</li>
<li>
<p>Detect and correct data corruption ("bitrot"). ZFS is one of the few storage
   systems that checksums everything, including the data itself, and is
   "self-healing".</p>
</li>
<li>
<p>Make it easy to use. Try to "end the suffering" for the admins involved in
   managing storage.</p>
</li>
</ol>
<p>ZFS includes a host of other features such as snapshots, transparent compression
and encryption. During the early years of ZFS, this all came with hardware
requirements only enterprise users could afford. By now, however, computers have
become so powerful that ZFS can run (with some effort) on a <a href="https://gist.github.com/mohakshah/b203d33a235307c40065bdc43e287547">Raspberry
Pi</a>. </p>
<p>FreeBSD and FreeNAS make extensive use of ZFS. What is holding ZFS back on Linux
are <a href="https://en.wikipedia.org/wiki/OpenZFS#History">licensing issues</a> beyond the
scope of this document. </p>
<p>Ansible-NAS doesn't actually specify a filesystem - you can use EXT4, XFS or
Btrfs as well. However, ZFS not only provides the benefits listed above, but
also lets you use your hard drives with different operating systems. Some people
now using Ansible-NAS came from FreeNAS, and were able to <code>export</code> their ZFS
storage drives there and <code>import</code> them to Ubuntu. On the other hand, if you ever
decide to switch back to FreeNAS or maybe want to use FreeBSD instead of Linux,
you should be able to use the same ZFS pools. </p>
<h2 id="an-overview-and-some-actual-commands">An overview and some actual commands</h2>
<p>Storage in ZFS is organized in <strong>pools</strong>. Inside these pools, you create
<strong>filesystems</strong> (also known as "datasets") which are like partitions on
steroids. For instance, you can keep each user's <code>/home</code> directory in a separate
filesystem. ZFS systems tend to use lots and lots of specialized filesystems
with tailored parameters such as record size and compression. All filesystems
share the available storage in their pool. </p>
<p>Pools do not directly consist of hard disks or SSDs. Instead, drives are
organized as <strong>virtual devices</strong> (VDEVs). This is where the physical redundancy
in ZFS is located. Drives in a VDEV can be "mirrored" or combined as "RaidZ",
roughly the equivalent of RAID5. These VDEVs are then combined into a pool by the
administrator. The command might look something like this:</p>
<pre><code>        sudo zpool create tank mirror /dev/sda /dev/sdb
</code></pre>

<p>This combines <code>/dev/sba</code> and <code>/dev/sdb</code> to a mirrored VDEV, and then defines a
new pool named <code>tank</code> consisting of this single VDEV. (Actually, you'd want to
use a different ID for the drives, but you get the idea.) You can now create a
filesystem in this pool for, say, all of your <em>Mass Effect</em> fan fiction: </p>
<pre><code>        sudo zfs create tank/mefanfic
</code></pre>

<p>You can then enable automatic compression on this filesystem with <code>sudo zfs set
compression=lz4 tank/mefanfic</code>. To take a <strong>snapshot</strong>, use</p>
<pre><code>        sudo zfs snapshot tank/mefanfic@21540411
</code></pre>

<p>Now, if evil people were somehow able to encrypt your precious fan fiction files
with ransomware, you can simply laugh maniacally and revert to the old version: </p>
<pre><code>        sudo zfs rollback tank/mefanfic@21540411
</code></pre>

<p>Of course, you would lose any texts you might have added to the filesystem
between that snapshot and now. Usually, you'll have some form of <strong>automatic
snapshot administration</strong> configured.</p>
<p>To detect bitrot and other data defects, ZFS periodically runs <strong>scrubs</strong>: The
system compares the available copies of each data record with their checksums.
If there is a mismatch, the data is repaired.</p>
<h2 id="known-issues">Known issues</h2>
<blockquote>
<p>At time of writing (April 2019), ZFS on Linux does not offer native
encryption, TRIM support or device removal, which are all scheduled to be
included in the upcoming <a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=ZFS-On-Linux-0.8-RC1-Released">0.8
release</a>
any day now.</p>
</blockquote>
<p>ZFS' original design for enterprise systems and redundancy requirements can make
some things difficult. You can't just add individual drives to a pool and tell
the system to reconfigure automatically. Instead, you have to either add a new
VDEV, or replace each of the existing drives with one of higher capacity. In an
enterprise environment, of course, you would just <em>buy</em> a bunch of new drives
and move the data from the old pool to the new pool. Shrinking a pool is even
harder - put simply, ZFS is not built for this, though it is <a href="https://www.delphix.com/blog/delphix-engineering/openzfs-device-removal">being worked
on</a>. </p>
<p>If you absolutely must be able to add or remove single drives, ZFS might not be
the filesystem for you. </p>
<h2 id="myths-and-misunderstandings">Myths and misunderstandings</h2>
<p>Information on the internet about ZFS can be outdated, conflicting or flat-out
wrong. Partially this is because it has been in use for almost 15 years now and
things change, partially it is the result of being used on different operating
systems which have minor differences under the hood. Also, Google searches tend
to first return the Oracle documentation for their closed source ZFS variant,
which is increasingly diverging from the open source OpenZFS standard.</p>
<p>To clear up some of the most common misunderstandings:</p>
<h3 id="no-zfs-does-not-need-at-least-8-gb-of-ram">No, ZFS does not need at least 8 GB of RAM</h3>
<p>This myth is especially common <a href="https://www.ixsystems.com/community/threads/does-freenas-really-need-8gb-of-ram.38685/">in FreeNAS
circles</a>.
Curiously, FreeBSD, the basis of FreeNAS, will run with <a href="https://wiki.freebsd.org/ZFSTuningGuide">1
GB</a>. The <a href="https://github.com/zfsonlinux/zfs/wiki/FAQ#hardware-requirements">ZFS on Linux
FAQ</a>, which is
more relevant for Ansible-NAS, states under "suggested hardware":</p>
<blockquote>
<p>8GB+ of memory for the best performance. It's perfectly possible to run with
2GB or less (and people do), but you'll need more if using deduplication.</p>
</blockquote>
<p>(Deduplication is only useful in <a href="http://open-zfs.org/wiki/Performance_tuning#Deduplication">special
cases</a>. If you are
reading this, you probably don't need it.)</p>
<p>Experience shows that 8 GB of RAM is in fact a sensible minimal amount for
continuous use. But it's not a requirement. What everybody agrees on is that ZFS
<em>loves</em> RAM and works better the more it has, so you should have as much of it
as you possibly can. When in doubt, add more RAM, and even more, and them some,
until your motherboard's capacity is reached.</p>
<h3 id="no-ecc-ram-is-not-required-for-zfs">No, ECC RAM is not required for ZFS</h3>
<p>This is another case where a recommendation has been taken as a requirement. To
quote the <a href="https://github.com/zfsonlinux/zfs/wiki/FAQ#do-i-have-to-use-ecc-memory-for-zfs">ZFS on Linux
FAQ</a>
again: </p>
<blockquote>
<p>Using ECC memory for OpenZFS is strongly recommended for enterprise
environments where the strongest data integrity guarantees are required.
Without ECC memory rare random bit flips caused by cosmic rays or by faulty
memory can go undetected. If this were to occur OpenZFS (or any other
filesystem) will write the damaged data to disk and be unable to automatically
detect the corruption.</p>
</blockquote>
<p>ECC corrects <a href="https://en.wikipedia.org/wiki/ECC_memory">single bit errors</a> in
memory. It is <em>always</em> better to have it on <em>any</em> computer if you can afford it,
and ZFS is no exception. However, there is absolutely no requirement for ZFS to
have ECC RAM. If you just don't care about the danger of random bit flips
because, hey, you can always just download <a href="https://archive.org/details/night_of_the_living_dead">Night of the Living
Dead</a> all over again,
you're perfectly free to use normal RAM. If you do use ECC RAM, make sure your
processor and motherboard support it.</p>
<h3 id="no-the-slog-is-not-really-a-write-cache">No, the SLOG is not really a write cache</h3>
<p>You'll read the suggestion to add a fast SSD or NVMe as a "SLOG drive"
(mistakenly also called "ZIL") for write caching. This isn't what happens,
because ZFS already includes <a href="https://linuxhint.com/configuring-zfs-cache/">a write
cache</a> in RAM. Since RAM is always
faster, adding a disk as a write cache doesn't even make sense. </p>
<p>What the <strong>ZFS Intent Log (ZIL)</strong> does, with or without a dedicated drive, is handle
synchronous writes. These occur when the system refuses to signal a successful
write until the data is actually stored on a physical disk somewhere. This keeps
the data safe, but is slower. </p>
<p>By default, the ZIL initially shoves a copy of the data on a normal VDEV
somewhere and then gives the thumbs up. The actual write to the pool is
performed later from the write cache in RAM, <em>not</em> the temporary copy. The data
there is only ever read if the power fails before the last step. The ZIL is all
about protecting data, not making transfers faster.</p>
<p>A <strong>Separate Intent Log (SLOG)</strong> is an additional fast drive for these temporary
synchronous writes. It simply allows the ZIL give the thumbs up quicker. This
means that a SLOG is never read unless the power has failed before the final
write to the pool. </p>
<p>Asynchronous writes just go through the normal write cache, by the way. If the
power fails, the data is gone.</p>
<p>In summary, the ZIL prevents data loss during synchronous writes, or at least
ensures that the data in storage is consistent. You always have a ZIL. A SLOG
will make the ZIL faster. You'll probably need to <a href="https://www.ixsystems.com/blog/o-slog-not-slog-best-configure-zfs-intent-log/">do some
research</a>
and some testing to figure out if your system would benefit from a SLOG. NFS for
instance uses synchronous writes, SMB usually doesn't. When in doubt, add more
RAM instead. </p>
<h2 id="further-reading-and-viewing">Further reading and viewing</h2>
<ul>
<li>
<p>In 2012, Aaron Toponce wrote a now slightly dated, but still very good
  <a href="https://pthree.org/2012/04/17/install-zfs-on-debian-gnulinux/">introduction</a>
  to ZFS on Linux. If you only read one part, make it the <a href="https://pthree.org/2012/12/07/zfs-administration-part-iv-the-adjustable-replacement-cache/">explanation of the
  ARC</a>,
  ZFS' read cache. </p>
</li>
<li>
<p>One of the best books on ZFS around is <em>FreeBSD Mastery: ZFS</em> by Michael W.
  Lucas and Allan Jude. Though it is written for FreeBSD, the general guidelines
  apply for all variants. There is a second volume for advanced use.</p>
</li>
<li>
<p>Jeff Bonwick, one of the original creators of ZFS, tells the story of how ZFS
  came to be <a href="https://www.youtube.com/watch?v=dcV2PaMTAJ4">on YouTube</a>.</p>
</li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../zfs_configuration/" title="ZFS Configuration" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                ZFS Configuration
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 - 2019 David Stephens
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/davestephens" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>