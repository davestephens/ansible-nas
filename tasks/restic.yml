---
- name: Create Restic Directory
  file:
    path: "{{ item }}"
    state: directory
  with_items:
    - "{{ restic_config_directory }}"

- name: Restic Docker Container
  docker_container:
    name: restic
    image: lobaro/restic-backup-docker:1.2-0.9.4
    pull: true
    env:
      RESTIC_PASSWORD: "{{ restic_password }}"
      RESTIC_TAG: "restic on {{ ansible_nas_hostname }}"
      BACKUP_CRON: "{{ restic_backup_cron }}"
      RESTIC_FORGET_ARGS: "{{ restic_forget_args }}"
    volumes:
      - "{{ restic_repository_dir }}:/mnt/restic"
      - "{{ samba_shares_root }}:/data"
      - "{{ restic_config_directory }}:/config:rw"
      - "/etc/timezone:/etc/timezone:ro"
    restart_policy: unless-stopped
